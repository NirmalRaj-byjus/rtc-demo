(this["webpackJsonpagora-rtc"]=this["webpackJsonpagora-rtc"]||[]).push([[0],{36:function(e,t,n){},58:function(e,t,n){},67:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),i=n(11),c=n.n(i),s=(n(36),function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,79)).then((function(t){var n=t.getCLS,a=t.getFID,o=t.getFCP,i=t.getLCP,c=t.getTTFB;n(e),a(e),o(e),i(e),c(e)}))}),r=n(28),l=n(5),u=n(2),d=n.n(u),h=n(4),b=n(24),f=n(25),C=n(30),m=n(29),p=n(6),g=n.n(p),v=(n(58),n(12)),j=n.n(v),T=n(13),k=n.n(T),S=n(14),x=n.n(S),O=n(15),M=n.n(O),R=n(1),A=function(e){var t=e.id,n=e.stream,a=e.onAVChange,o=e.isTute,i=void 0!==o&&o,c=e.tuteControls,s=void 0===c?{}:c,r=n.audioState,l=n.videoState;return Object(R.jsxs)("div",{className:"remoteStreamItem",children:[Object(R.jsx)("div",{className:"remoteStream",id:t}),Object(R.jsxs)("div",{className:"controls",children:[Object(R.jsx)("div",{className:"controlIcon",children:l?Object(R.jsx)(j.a,{fontSize:"small"}):Object(R.jsx)(k.a,{fontSize:"small"})}),Object(R.jsx)("div",{className:"controlIcon",children:r?Object(R.jsx)(x.a,{fontSize:"small"}):Object(R.jsx)(M.a,{fontSize:"small"})})]}),i&&Object(R.jsxs)("div",{className:"controls",children:[Object(R.jsx)("button",{className:"controlIcon",onClick:function(){return a(t,"video",s.video)},children:s.video?"Video on":"Video off"}),Object(R.jsx)("button",{className:"controlIcon",onClick:function(){return a(t,"audio",s.audio)},children:s.audio?"Audio on":"Audio off"})]})]})},V=n(27),y=n.n(V),L=function(e){Object(C.a)(n,e);var t=Object(m.a)(n);function n(e){var a;return Object(b.a)(this,n),(a=t.call(this,e)).initRTM=function(){a.RTMClient=y.a.createInstance(a.appId),a.subscribeClientEvents()},a.getChannelCount=function(){a.RTMClient.getChannelMemberCount([a.channel]).then((function(e){console.log(" =>> getChannelMemberCount",e)})).catch((function(e){console.log(" =>> failed to get getChannelMemberCount",e)}))},a.loginToRTM=Object(h.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==a.state.uid){e.next=3;break}return alert("please enter username"),e.abrupt("return");case 3:a.RTMClient.login({uid:a.state.uid,token:null}).then((function(e){console.log(" =>> RTM Loggin successfull!"),a.RTMChannel=a.RTMClient.createChannel(a.channel),a.setState({rtmLoggedIn:!0,isTute:"admin"===a.state.uid}),a.getAVStates()})).catch((function(e){console.log(" =>> failed to login RTM",e)}));case 4:case"end":return e.stop()}}),e)}))),a.getAVStates=function(){a.RTMClient.getChannelAttributes(a.channel).then((function(e){console.log("=>> channel attrs",e);var t=e.av?JSON.parse(e.av.value):{};console.log("=>> controls tute",t),a.checkForInitialMute(t),a.setState({tuteControls:t})})).catch((function(e){console.log("failed to get channel attrs",e)}))},a.checkForInitialMute=function(e){var t=e[a.state.uid]||null,n=Object(l.a)({},a.state.tuteAVControls);t&&(console.log("attr ",t,!n.audio,!n.video),t.audio||(a.muteUser("audio"),n.audio=!1),t.video||(a.muteUser("video"),n.video=!1),a.setState({tuteAVControls:n}))},a.joinSessionChannel=Object(h.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.RTMChannel.join().then((function(e){console.log(" =>> Channel joined successfull!",e),a.joinChannel(),a.setState({rtmChannelJoined:!0})})).catch((function(e){console.log(" =>> Error joining channel",e)}));case 1:case"end":return e.stop()}}),e)}))),a.subscribeChannelEvents=function(){a.RTMChannel.on("ChannelMessage",(function(e,t){console.log("ChannelMessage =>>",e,t)})),a.RTMChannel.on("MemberJoined",(function(e){console.log("MemberJoined =>>",e)})),a.RTMChannel.on("MemberLeft",(function(e){console.log("MemberLeft =>>",e)})),a.RTMChannel.on("AttributesUpdated",(function(e){console.log("AttributesUpdated =>>",e)}))},a.subscribeClientEvents=function(){a.RTMClient.on("ConnectionStateChanged",(function(e){console.log("ConnectionStateChanged =>>",e)})),a.RTMClient.on("MessageFromPeer",(function(e,t){console.log("MessageFromPeer =>>",e,t);var n=JSON.parse(e.text);console.log("=>> msg",n),!1===n.value&&a.muteUser(n.type);var o=Object(l.a)({},a.state.tuteAVControls);o[n.type]=n.value,a.setState({tuteAVControls:o})}))},a.muteUser=function(e){"audio"===e?a.state.localAudio&&(a.audioTrack.setEnabled(!1),a.setState({localAudio:!1})):"video"===e&&a.state.localVideo&&(a.videoTrack.setEnabled(!1),a.setState({localVideo:!1}))},a.initLocalStream=Object(h.a)(d.a.mark((function e(){var t,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.a.createMicrophoneAndCameraTracks();case 3:t=e.sent,n=Object(r.a)(t,2),a.audioTrack=n[0],a.videoTrack=n[1],a.videoTrack.play(a.localVideoView.current),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),alert("please check the permission for audio/camera"),console.log("Weeoe",e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,10]])}))),a.onDeviceChange=function(){g.a.onMicrophoneChanged=a.onMicrophoneChanged},a.onCameraChanged=function(e){console.log("camera changed!",e.state,e.device)},a.onMicrophoneChanged=function(){var e=Object(h.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("LLL  newdevice",t);try{g.a.getDevices().then(function(){var e=Object(h.a)(d.a.mark((function e(t){var n,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.filter((function(e){return"audioinput"===e.kind})),console.log(n),!(n.length>0)){e.next=11;break}return e.next=5,g.a.createMicrophoneAudioTrack(n[0].deviceId);case 5:if(o=e.sent,!a.state.audioPublished){e.next=10;break}return e.next=9,a.RTCClient.unpublish(a.audioTrack);case 9:a.state.localAudio?a.publishTrack(o):a.setState({audioPublished:!1});case 10:a.audioTrack=o;case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}catch(n){console.log("Error on get device,",n)}case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.publishTrack=function(e){a.RTCClient.publish(e).then((function(t){"audio"===e.trackMediaType?a.setState({audioPublished:!0}):"video"===e.trackMediaType&&a.setState({videoPublished:!0})})).catch((function(t){console.log("Failed to published track :"+e.trackMediaType,e.trackMediaType,t)}))},a.unpublishTrack=function(){var e=Object(h.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.RTCClient.unpublish(t).then((function(){console.log("unpublishTrack =>> :track unpublished",t)})).catch((function(e){console.log("unpublishTrack =>> : failed to unpublish track",e)}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.initClient=function(){a.RTCClient=g.a.createClient({mode:"rtc",codec:"vp8"}),a.subscribeEvents()},a.subscribeEvents=function(){a.RTCClient.on("user-published",a.userPublished),a.RTCClient.on("user-unpublished",a.userUnPublished),a.RTCClient.on("user-left",a.userLeft),a.RTCClient.on("user-joined",a.userJoined)},a.userLeft=function(e,t){console.log("userLeft Reason",t);var n=Object(l.a)({},a.state.remoteStreams);delete n[e.uid],a.setState({remoteStreams:n})},a.userJoined=function(e){var t=Object(l.a)({},a.state.remoteStreams);t[e.uid]={uid:e.uid,videoState:!1,audioState:!1},a.setState({remoteStreams:t})},a.userPublished=function(){var e=Object(h.a)(d.a.mark((function e(t,n){var o,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("LLLLL pub =>>>> ",n),e.next=3,a.RTCClient.subscribe(t,n);case 3:return e.next=5,a.RTCClient.setRemoteVideoStreamType(t.uid,0);case 5:return e.next=7,a.RTCClient.setStreamFallbackOption(t.uid,2);case 7:o=Object(l.a)({},a.state.remoteStreams),i=t.uid,"video"===n?(t.videoTrack.play(i+""),o[i].videoState=!0):"audio"===n&&(t.audioTrack.play(),o[i].audioState=!0),a.setState({remoteStreams:o});case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),a.userUnPublished=function(){var e=Object(h.a)(d.a.mark((function e(t,n){var o,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("LLLLL unpub =>>>> ",n),e.next=3,a.RTCClient.unsubscribe(t,n);case 3:o=t.uid,(i=Object(l.a)({},a.state.remoteStreams))[o]&&("video"===n?i[o].videoState=!1:"audio"===n&&(i[o].audioState=!1),a.setState({remoteStreams:i}));case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),a.joinChannel=function(){null!==a.RTCClient&&a.RTCClient.join(a.appId,a.channel,null,a.state.uid).then((function(e){a.rtm.params.uid=e,a.RTCClient.enableDualStream().then((function(){console.log("Enable Dual stream success!")})).catch((function(e){console.log(e)})),a.state.localVideo&&a.publishTrack(a.videoTrack),a.state.localAudio&&a.publishTrack(a.audioTrack)})).catch((function(e){console.log("failed to join channel ",e)}))},a.toggleTrack=function(){var e=Object(h.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("video"!==t||!a.state.tuteAVControls.video){e.next=12;break}if(!a.state.localVideo){e.next=6;break}return e.next=4,a.videoTrack.setEnabled(!1);case 4:e.next=9;break;case 6:return e.next=8,a.videoTrack.setEnabled(!0);case 8:a.state.videoPublished||a.publishTrack(a.videoTrack);case 9:a.setState({localVideo:!a.state.localVideo}),e.next=22;break;case 12:if("audio"!==t||!a.state.tuteAVControls.audio){e.next=22;break}if(!a.state.localAudio){e.next=18;break}return e.next=16,a.audioTrack.setEnabled(!1);case 16:e.next=21;break;case 18:return e.next=20,a.audioTrack.setEnabled(!0);case 20:a.state.audioPublished||a.publishTrack(a.audioTrack);case 21:a.setState({localAudio:!a.state.localAudio});case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.onAVChange=function(e,t,n){var o=Object(l.a)({},a.state.tuteControls),i=o[e]?Object(l.a)({},o[e]):{};i[t]=!n,o[e]=i,a.RTMClient.addOrUpdateChannelAttributes(a.channel,{av:JSON.stringify(o)}).then((function(i){console.log("AV updated successfully!");var c=JSON.stringify({type:t,value:!n});a.RTMClient.sendMessageToPeer({text:c},e.toString()).then((function(e){console.log("sendResult =>>",e),e.hasPeerReceived&&a.setState({tuteControls:o})})).catch((function(e){console.log("failed to send peer meg",e)}))}))},a.getChannelAttr=function(){a.RTMClient.getChannelAttributes(a.channel).then((function(e){console.log("=>> channel attrs",e)})).catch((function(e){console.log("failed to get channel attrs",e)}))},a.state={localStreamInitiated:!1,remoteStreams:{},localVideo:!0,localAudio:!0,videoPublished:!1,audioPublished:!1,rtmLoggedIn:!1,rtmChannelJoined:!1,uid:"",tuteAVControls:{audio:!0,video:!0},isTute:!1,tuteControls:{}},a.videoTrack=null,a.audioTrack=null,a.RTMChannel=null,a.RTCClient=null,a.RTMClient=null,a.channel="demo_channel_name",a.localVideoView=o.a.createRef(),a.appId="b8f5d7b5efcc4ba8992ac09d46a591b1",a.rtm={params:{}},a}return Object(f.a)(n,[{key:"componentDidMount",value:function(){this.initRTM(),this.initLocalStream(),this.onDeviceChange(),this.initClient()}},{key:"render",value:function(){var e=this,t=this.state,n=t.remoteStreams,a=t.rtmLoggedIn,o=t.rtmChannelJoined,i=t.tuteControls;return console.log("streams =>>",n),Object(R.jsxs)("div",{className:"App",children:[Object(R.jsxs)("div",{className:"localStreamContainer",children:[Object(R.jsx)("input",{className:"input",value:this.state.uid,onChange:function(t){return e.setState({uid:t.target.value})},placeholder:"enter user name"}),Object(R.jsx)("div",{id:"localView",ref:this.localVideoView}),Object(R.jsxs)("div",{className:"controls",children:[Object(R.jsx)("div",{className:"controlIcon",onClick:function(){return e.toggleTrack("video")},children:this.state.localVideo?Object(R.jsx)(j.a,{fontSize:"large"}):Object(R.jsx)(k.a,{fontSize:"large"})}),Object(R.jsx)("div",{className:"controlIcon",onClick:function(){return e.toggleTrack("audio")},children:this.state.localAudio?Object(R.jsx)(x.a,{fontSize:"large"}):Object(R.jsx)(M.a,{fontSize:"large"})})]}),!a&&Object(R.jsx)("button",{className:"join",onClick:this.loginToRTM,children:"Login RTM"}),a&&!o&&Object(R.jsx)("button",{className:"join",onClick:this.joinSessionChannel,children:"Join Channel"}),Object(R.jsx)("button",{className:"join",onClick:this.getChannelCount,children:"Member count"}),Object(R.jsx)("button",{className:"join",onClick:this.getChannelAttr,children:"Get channel attr"})]}),Object(R.jsx)("div",{className:"remoteStreamContainer",children:Object.keys(n).map((function(t,a){return Object(R.jsx)(A,{isTute:e.state.isTute,onAVChange:e.onAVChange,tuteControls:i[t],stream:n[t],id:t},t)}))})]})}}]),n}(o.a.Component);c.a.render(Object(R.jsx)(o.a.StrictMode,{children:Object(R.jsx)("div",{style:{display:"flex"},children:Object(R.jsx)(L,{})})}),document.getElementById("root")),s()}},[[67,1,2]]]);
//# sourceMappingURL=main.a16ea277.chunk.js.map